import os
from dotenv import load_dotenv
from loguru import logger

load_dotenv()

# Telegram settings
BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
CHANNEL_ID = os.getenv("TELEGRAM_CHANNEL_ID")

# OpenAI settings
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

# Валидация обязательных переменных окружения
def validate_config():
    """Проверяет наличие всех обязательных переменных окружения"""
    errors = []
    
    if not BOT_TOKEN:
        errors.append("TELEGRAM_BOT_TOKEN не установлен")
    elif BOT_TOKEN == "your_bot_token_here":
        errors.append("TELEGRAM_BOT_TOKEN не настроен (используется значение по умолчанию)")
    
    if not CHANNEL_ID:
        errors.append("TELEGRAM_CHANNEL_ID не установлен")
    elif CHANNEL_ID == "your_channel_id_here":
        errors.append("TELEGRAM_CHANNEL_ID не настроен (используется значение по умолчанию)")
    
    if not OPENAI_API_KEY:
        errors.append("OPENAI_API_KEY не установлен")
    elif OPENAI_API_KEY == "your_openai_key_here":
        errors.append("OPENAI_API_KEY не настроен (используется значение по умолчанию)")
    
    if errors:
        error_msg = "Ошибки конфигурации:\n" + "\n".join(f"  - {e}" for e in errors)
        logger.error(error_msg)
        raise ValueError(error_msg)
    
    logger.info("Конфигурация валидирована успешно")
    logger.debug(f"BOT_TOKEN: {'*' * 10 if BOT_TOKEN else 'НЕ УСТАНОВЛЕН'}")
    logger.debug(f"CHANNEL_ID: {CHANNEL_ID}")
    logger.debug(f"OPENAI_API_KEY: {'*' * 10 if OPENAI_API_KEY else 'НЕ УСТАНОВЛЕН'}")

# Выполняем валидацию при импорте
try:
    validate_config()
except ValueError:
    # Не прерываем выполнение, но логируем ошибку
    pass

# Bot behavior settings
MESSAGE_THRESHOLD_MIN = 5  # Минимальное количество сообщений для ответа
MESSAGE_THRESHOLD_MAX = 9  # Максимальное количество сообщений для ответа

ACTIVITY_TIMEOUT = 3600  # 1 час в секундах (время до объявления канала "тихим")

# Scheduled posts (3 раза в день с рандомом ±30 минут)
SCHEDULED_POSTS = [
    {"hour": 9, "minute": 0},   # Утро: 9:00 ±30 минут
    {"hour": 14, "minute": 0},  # День: 14:00 ±30 минут
    {"hour": 20, "minute": 0},  # Вечер: 20:00 ±30 минут
]

# ChatGPT prompts
JOKE_PROMPT = """Ты - гопник-матершинник из плохого района. Сгенерируй пошлую шутку или анекдот с матерной лексикой и грубым юмором. 
Шутка должна быть в стиле 'за 300', циничная и без политкорректности. Ответь ТОЛЬКО текстом шутки, без пояснений."""

MEME_PROMPT = """Ты - гопник-матершинник из плохого района. Сгенерируй мемную цитату в стиле Стетхема из рунета. 
Используй характерные фразы типа "Ясно, понятно", "Короче", "Решил я тут пофилософствовать", "Твоя мать в отпуске" и подобные.
Добавь мат и грубый юмор. Ответь ТОЛЬКО текстом цитаты, без пояснений."""

# Список мемных цитат Стетхема для fallback
STETHEM_QUOTES = [
    "Ясно, понятно. Короче, решил я тут пофилософствовать с вами, интеллигентами...",
    "Твоя мать в отпуске, так что и я в отпуске от остроумия.",
    "Короче, я тут подумал - а что если мы все умрем? И что тогда?",
    "Ясно, понятно. Жизнь - это как поезд, только без билетов и кондуктора.",
    "Короче, решил я тут пофилософствовать. А что если мы все живем в матрице?",
    "Твоя мать в отпуске, а я тут думаю - а зачем вообще жить?",
    "Ясно, понятно. Короче, жизнь - это как суп, только без ложки.",
    "Короче, решил я тут пофилософствовать с вами, умниками. А что если мы все роботы?",
    "Твоя мать в отпуске, а я тут думаю - а что если смерти нет?",
    "Ясно, понятно. Короче, решил я тут пофилософствовать. А что если мы все сны?",
    "Короче, я тут подумал - а что если мы все живем в чьем-то сне?",
    "Твоя мать в отпуске, а я тут думаю - а что если мы все уже мертвы?",
    "Ясно, понятно. Короче, решил я тут пофилософствовать с вами, умниками.",
    "Короче, я тут подумал - а что если мы все живем в симуляции?",
    "Твоя мать в отпуске, а я тут думаю - а что если мы все галлюцинации?"
]

COMMENT_PROMPT_TEMPLATE = """Ты - гопник-матершинник из плохого района. В канале идет обсуждение следующей темы:

{conversation_context}

Напиши грубый, циничный и матерный комментарий по этой теме в стиле гопника. Комментарий должен быть:
- Кратким (1-2 предложения)
- С матерной лексикой
- Циничным и грубым
- Без политкорректности

Ответь ТОЛЬКО текстом комментария, без пояснений."""

MENTION_PROMPT_TEMPLATE = """Ты - гопник-матершинник из плохого района. К тебе обратился пользователь {username} со следующим сообщением:

"{message_text}"

Ответь ему грубо и матерно в стиле гопника. Ответ должен быть:
- Кратким (1-2 предложения)
- С матерной лексикой
- Циничным и грубым
- Прямым ответом на его сообщение

Ответь ТОЛЬКО текстом ответа, без пояснений."""

# OpenAI model
OPENAI_MODEL = "gpt-4o-mini"

